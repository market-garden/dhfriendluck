<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
<ModulePrefs title="knowfriends(XN)"
               description="A simple tool,to list all information about your friends."
               author="Hui Deng"
			   author_email="denghui.1984@googlemail.com" 
			   author_location="Deutschland"
			   screenshot="http://farm4.static.flickr.com/3575/3468195032_ef1c2edcb6.jpg"
               thumbnail="http://farm4.static.flickr.com/3523/3468195034_2c55b76afa_m.jpg">
  <Require feature="opensocial-0.8" /> 
  <Require feature="dynamic-height" /> 
  </ModulePrefs>
<Content type="html">
<![CDATA[ 
       
	   <script type="text/javascript" language="JavaScript" src="http://dhfriendluck.googlecode.com/svn/trunk/getpersonmore.js"></script>  
	   <script type="text/javascript">

          var owner;
		  var ownerFriends;
		  
		  function showBasic(){
          document.getElementById('me').innerHTML ='<a href ="javascript:void(0);" onclick="getpersonmore(1)" >'+owner.getDisplayName() +'</a>';
          
          var len = ownerFriends.size();
		  document.getElementById('fnum').innerHTML = len + "  " ;
		  
		  
		  html = new Array();
          html.push('<select id="person">');
          ownerFriends.each(function(person) {
          if (person.getId()) {
               html.push('<option value="', person.getId(), '">', person.getDisplayName(), '</option>');
            }
          });
          html.push('</select>');
          document.getElementById('friends').innerHTML = html.join('');
          gadgets.window.adjustHeight();
		  } 
		  
		  
		  
		  function loadAll() {
          var opt_params = {};
		  opt_params[opensocial.DataRequest.PeopleRequestFields.MAX] = 500;
          opt_params[opensocial.DataRequest.PeopleRequestFields.PROFILE_DETAILS] =
										[
											  opensocial.Person.Field.NAME, 
											  opensocial.Person.Field.GENDER, 
											  opensocial.Person.Field.THUMBNAIL_URL,
											  'headUrl',
											  'mainUrl',
											  'birthday',
											  'star',
											  opensocial.Person.Field.ADDRESSES, 
											  'organizations',
											  'highSchool',
				                              'university',
                                               opensocial.Person.Field.AGE,
                                               opensocial.Person.Field.DATE_OF_BIRTH,
											   opensocial.Person.Field.HAS_APP,
                                          ];

		  
		  
		  var req = opensocial.newDataRequest();
		  //req.add(req.newFetchPersonRequest(opensocial.IdSpec.PersonId.VIEWER, opt_params), 'v');
          req.add(req.newFetchPersonRequest(opensocial.IdSpec.PersonId.OWNER, opt_params), 'o');
		  //var vfidspec = opensocial.newIdSpec({ "userId" : "VIEWER", "groupId" : "FRIENDS" });
          // req.add(req.newFetchPeopleRequest(vfidspec, opt_params), 'vf');
		  var ofidspec = opensocial.newIdSpec({ "userId" : "OWNER", "groupId" : "FRIENDS" });
          req.add(req.newFetchPeopleRequest(ofidspec, opt_params), 'of');
		  req.send(onloadAll);
         }

        function onloadAll(data) {
          owner = data.get('o').getData();
          ownerFriends = data.get('of').getData();
          //viewer = data.get('v').getData();
          //viewerFriends = data.get('vf').getData();
          showBasic();
        }

        function init() {
          loadAll();
        }
        
        gadgets.util.registerOnLoadHandler(init);
      </script>
     
        <div id='main'>
          Hello,my name is<b id = 'me'></b>,I have <b id = 'fnum'></b>friends.
		  <form id='friends_form'>
            Get more infomation about myfiend:<span id='friends'></span>. <a href='javascript:void(0);' onclick='getpersonmore();'>Go!</a>
          </form>
        </div>
        <div id='info'>
        </div>   
  ]]> 
  </Content>
  </Module>